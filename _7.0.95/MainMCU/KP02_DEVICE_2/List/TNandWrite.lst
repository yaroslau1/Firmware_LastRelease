###############################################################################
#
# IAR ANSI C/C++ Compiler V7.40.2.8542/W32 for ARM        08/Oct/2018  09:58:13
# Copyright 1999-2015 IAR Systems AB.
#
#    Cpu mode     =  thumb
#    Endian       =  little
#    Source file  =  
#        D:\WORK\Firmware_LastRelease\_7.0.95\MainMCU\TNandWrite.cpp
#    Command line =  
#        D:\WORK\Firmware_LastRelease\_7.0.95\MainMCU\TNandWrite.cpp -D
#        IAR_ARM_CM4 -D USE_STDPERIPH_DRIVER -D STM32F40_41xxx -D HAVE_CONFIG_H
#        -D SD_SPI_MODE -D USE_FULL_ASSERT -D DEVICE_2 -D TFT -D
#        STENDBUY_NOT_USE -D SCREEN_NOT_ROTATE -D USE_ADS1292R -D DISPLAY_GPIO
#        -D BUFFERED_TRANSFER -D LCD_TRACE -lCN
#        D:\WORK\Firmware_LastRelease\_7.0.95\MainMCU\KP02_DEVICE_2\List\ -o
#        D:\WORK\Firmware_LastRelease\_7.0.95\MainMCU\KP02_DEVICE_2\Obj\
#        --no_unroll --no_inline --no_tbaa --no_scheduling --debug
#        --endian=little --cpu=Cortex-M4F -e --fpu=VFPv4_sp --dlib_config
#        "D:\Program Files (x86)\IAR Systems\Embedded Workbench
#        7.2\arm\INC\c\DLib_Config_Normal.h" -I
#        D:\WORK\Firmware_LastRelease\_7.0.95\MainMCU\ -I
#        D:\WORK\Firmware_LastRelease\_7.0.95\MainMCU\FatFs\ -I
#        D:\WORK\Firmware_LastRelease\_7.0.95\MainMCU\FreeRTOS\Source\include\
#        -I
#        D:\WORK\Firmware_LastRelease\_7.0.95\MainMCU\FreeRTOS\Source\portable\IAR\ARM_CM3\
#        -I
#        D:\WORK\Firmware_LastRelease\_7.0.95\MainMCU\Libraries\CMSIS\CM4\CoreSupport\
#        -I
#        D:\WORK\Firmware_LastRelease\_7.0.95\MainMCU\Libraries\CMSIS\CM4\DeviceSupport\STM32F4xx\
#        -I
#        D:\WORK\Firmware_LastRelease\_7.0.95\MainMCU\Libraries\STM32F4xx_StdPeriph_Driver\inc\
#        -I
#        D:\WORK\Firmware_LastRelease\_7.0.95\MainMCU\Libraries\STM32F10x_Speex_Lib\include\speex\
#        -I
#        D:\WORK\Firmware_LastRelease\_7.0.95\MainMCU\Libraries\STM32F10x_Speex_Lib\include\
#        -I
#        D:\WORK\Firmware_LastRelease\_7.0.95\MainMCU\Libraries\STM32F10x_Speex_Lib\libspeex\
#        -I
#        D:\WORK\Firmware_LastRelease\_7.0.95\MainMCU\Libraries\STM32F10x_Speex_Lib\STM32\include\speex\
#        -I
#        D:\WORK\Firmware_LastRelease\_7.0.95\MainMCU\Libraries\STM32F10x_Speex_Lib\STM32\include\
#        -I
#        D:\WORK\Firmware_LastRelease\_7.0.95\MainMCU\Libraries\STM32F10x_Speex_Lib\STM32\
#        -I
#        D:\WORK\Firmware_LastRelease\_7.0.95\MainMCU\Libraries\STM32F10x_Speex_Lib\STM32\libspeex\
#        -I
#        D:\WORK\Firmware_LastRelease\_7.0.95\MainMCU\Libraries\STM32F10x_Speex_Lib\STM32\libspeex\iar\
#        -I D:\WORK\Firmware_LastRelease\_7.0.95\MainMCU\Fonts\ -Om --ec++
#    List file    =  
#        D:\WORK\Firmware_LastRelease\_7.0.95\MainMCU\KP02_DEVICE_2\List\TNandWrite.lst
#    Object file  =  
#        D:\WORK\Firmware_LastRelease\_7.0.95\MainMCU\KP02_DEVICE_2\Obj\TNandWrite.o
#
###############################################################################

D:\WORK\Firmware_LastRelease\_7.0.95\MainMCU\TNandWrite.cpp
      1          /*
      2              Title:
      3              Author:   VN Asliuk(Cardian)
      4              Date:     15.10.2010 16:38:20
      5              Purpose:
      6              Software:
      7              Hardware:
      8              Note:
      9          */
     10          //------------------------------------------------------------------------------------
     11          #include "TNandWrite.h"
     12          #include "ff.h"
     13          #include "TGuiObjectsV2.h"
     14          #include "TSDProcessor.h"
     15          #include "TDevice.h"
     16          #include "TInterpreter.h"
     17          
     18          //#include "TEcc.h"
     19          //#include "TEepBackUp.h"
     20          //------------------------------------------------------------------------------------
     21          xTaskHandle TNandWrite::xhDataWrite;
     22          FIL f1;
     23          FIL f2;
     24          extern bool StopModePeriod;
     25          //------------------------------------------------------------------------------------
     26          int   TNandWrite::DataBufferIndx = 0;

   \                                 In section .bss, align 4
     27          int   TNandWrite::NW_PageIndx = 0;
   \                     _ZN10TNandWrite11NW_PageIndxE:
   \   00000000                      DS8 4
     28          bool   TNandWrite::MakeECC = true;

   \                                 In section .bss, align 1
     29          bool  TNandWrite::ForcedWritePage = false;
   \                     _ZN10TNandWrite15ForcedWritePageE:
   \   00000000                      DS8 1
     30          bool  TNandWrite::AddDataBuffHalfTransferFlag = false;

   \                                 In section .bss, align 4
     31          int   TNandWrite::txBufferIndx = 0;
   \                     _ZN10TNandWrite12txBufferIndxE:
   \   00000000                      DS8 4
     32          int   TNandWrite::ICI_IRQ_Cnt  = -50;
     33          //NAND_ADDRESS TNandWrite::WriteAddr;
     34          //------------------------------------------------------------------------------------

   \                                 In section .bss, align 4
     35          uint8_t TNandWrite::Data256Buffer[NW_DATABUFF_SZ];
   \                     _ZN10TNandWrite13Data256BufferE:
   \   00000000                      DS8 16384
     36          //------------------------------------------------------------------------------------
     37          volatile bool TNandWrite::BeginDataWFrame = false;
     38          //------------------------------------------------------------------------------------
     39          //WFrameHeader TNandWrite::wfStor;
     40          wfType   TNandWrite::WF_Type;
     41          uint32_t TNandWrite::DataBlockLenghtNBlockCRC = 0; 
     42          uint32_t TNandWrite::DataBlockNum = 0;
     43          uint32_t TNandWrite::DataBlockSample;
     44          //------------------------------------------------------------------------------------

   \                                 In section .bss, align 4
     45          int  TNandWrite::RecordSize = 0;
   \                     _ZN10TNandWrite10RecordSizeE:
   \   00000000                      DS8 4
     46          //------------------------------------------------------------------------------------
     47          bool TNandWrite::GlobalEnableWriting = true;

   \                                 In section .bss, align 1
     48          bool TNandWrite::MemoryFull = false;  
   \                     _ZN10TNandWrite10MemoryFullE:
   \   00000000                      DS8 1

   \                                 In section .bss, align 2
     49          uint16_t TNandWrite::StartWriteAddrBlock = 0;
   \                     _ZN10TNandWrite19StartWriteAddrBlockE:
   \   00000000                      DS8 2
     50          //------------------------------------------------------------------------------------

   \                                 In section .bss, align 1
     51          bool TNandWrite::KeepFirstBlockAsNoMemFull = false;
   \                     _ZN10TNandWrite25KeepFirstBlockAsNoMemFullE:
   \   00000000                      DS8 1
     52          //------------------------------------------------------------------------------------

   \                                 In section .bss, align 1
     53          bool TNandWrite::UnexpectedReset = false;
   \                     _ZN10TNandWrite15UnexpectedResetE:
   \   00000000                      DS8 1
     54          //------------------------------------------------------------------------------------
     55          volatile bool WaitWrProcess = false;
     56          bool TNandWrite::FlashCardRemoved = false;
     57          bool TNandWrite::NandWrProcc = false;
     58          
     59          //------------------------------------------------------------------------------------
     60          
     61          

   \                                 In section .text, align 4, keep-with-next
     62          const unsigned char Crc8Table[256] = {
   \                     Crc8Table:
   \   00000000   0x00 0x31          DC8 0, 49, 98, 83, 196, 245, 166, 151, 185, 136, 219, 234, 125, 76, 31
   \              0x62 0x53    
   \              0xC4 0xF5    
   \              0xA6 0x97    
   \              0xB9 0x88    
   \              0xDB 0xEA    
   \              0x7D 0x4C    
   \              0x1F         
   \   0000000F   0x2E 0x43          DC8 46, 67, 114, 33, 16, 135, 182, 229, 212, 250, 203, 152, 169, 62, 15
   \              0x72 0x21    
   \              0x10 0x87    
   \              0xB6 0xE5    
   \              0xD4 0xFA    
   \              0xCB 0x98    
   \              0xA9 0x3E    
   \              0x0F         
   \   0000001E   0x5C 0x6D          DC8 92, 109, 134, 183, 228, 213, 66, 115, 32, 17, 63, 14, 93, 108, 251
   \              0x86 0xB7    
   \              0xE4 0xD5    
   \              0x42 0x73    
   \              0x20 0x11    
   \              0x3F 0x0E    
   \              0x5D 0x6C    
   \              0xFB         
   \   0000002D   0xCA 0x99          DC8 202, 153, 168, 197, 244, 167, 150, 1, 48, 99, 82, 124, 77, 30, 47
   \              0xA8 0xC5    
   \              0xF4 0xA7    
   \              0x96 0x01    
   \              0x30 0x63    
   \              0x52 0x7C    
   \              0x4D 0x1E    
   \              0x2F         
   \   0000003C   0xB8 0x89          DC8 184, 137, 218, 235, 61, 12, 95, 110, 249, 200, 155, 170, 132, 181
   \              0xDA 0xEB    
   \              0x3D 0x0C    
   \              0x5F 0x6E    
   \              0xF9 0xC8    
   \              0x9B 0xAA    
   \              0x84 0xB5    
   \   0000004A   0xE6 0xD7          DC8 230, 215, 64, 113, 34, 19, 126, 79, 28, 45, 186, 139, 216, 233, 199
   \              0x40 0x71    
   \              0x22 0x13    
   \              0x7E 0x4F    
   \              0x1C 0x2D    
   \              0xBA 0x8B    
   \              0xD8 0xE9    
   \              0xC7         
   \   00000059   0xF6 0xA5          DC8 246, 165, 148, 3, 50, 97, 80, 187, 138, 217, 232, 127, 78, 29, 44
   \              0x94 0x03    
   \              0x32 0x61    
   \              0x50 0xBB    
   \              0x8A 0xD9    
   \              0xE8 0x7F    
   \              0x4E 0x1D    
   \              0x2C         
   \   00000068   0x02 0x33          DC8 2, 51, 96, 81, 198, 247, 164, 149, 248, 201, 154, 171, 60, 13, 94
   \              0x60 0x51    
   \              0xC6 0xF7    
   \              0xA4 0x95    
   \              0xF8 0xC9    
   \              0x9A 0xAB    
   \              0x3C 0x0D    
   \              0x5E         
   \   00000077   0x6F 0x41          DC8 111, 65, 112, 35, 18, 133, 180, 231, 214, 122, 75, 24, 41, 190, 143
   \              0x70 0x23    
   \              0x12 0x85    
   \              0xB4 0xE7    
   \              0xD6 0x7A    
   \              0x4B 0x18    
   \              0x29 0xBE    
   \              0x8F         
   \   00000086   0xDC 0xED          DC8 220, 237, 195, 242, 161, 144, 7, 54, 101, 84, 57, 8, 91, 106, 253
   \              0xC3 0xF2    
   \              0xA1 0x90    
   \              0x07 0x36    
   \              0x65 0x54    
   \              0x39 0x08    
   \              0x5B 0x6A    
   \              0xFD         
   \   00000095   0xCC 0x9F          DC8 204, 159, 174, 128, 177, 226, 211, 68, 117, 38, 23, 252, 205, 158
   \              0xAE 0x80    
   \              0xB1 0xE2    
   \              0xD3 0x44    
   \              0x75 0x26    
   \              0x17 0xFC    
   \              0xCD 0x9E    
   \   000000A3   0xAF 0x38          DC8 175, 56, 9, 90, 107, 69, 116, 39, 22, 129, 176, 227, 210, 191, 142
   \              0x09 0x5A    
   \              0x6B 0x45    
   \              0x74 0x27    
   \              0x16 0x81    
   \              0xB0 0xE3    
   \              0xD2 0xBF    
   \              0x8E         
   \   000000B2   0xDD 0xEC          DC8 221, 236, 123, 74, 25, 40, 6, 55, 100, 85, 194, 243, 160, 145, 71
   \              0x7B 0x4A    
   \              0x19 0x28    
   \              0x06 0x37    
   \              0x64 0x55    
   \              0xC2 0xF3    
   \              0xA0 0x91    
   \              0x47         
   \   000000C1   0x76 0x25          DC8 118, 37, 20, 131, 178, 225, 208, 254, 207, 156, 173, 58, 11, 88
   \              0x14 0x83    
   \              0xB2 0xE1    
   \              0xD0 0xFE    
   \              0xCF 0x9C    
   \              0xAD 0x3A    
   \              0x0B 0x58    
   \   000000CF   0x69 0x04          DC8 105, 4, 53, 102, 87, 192, 241, 162, 147, 189, 140, 223, 238, 121
   \              0x35 0x66    
   \              0x57 0xC0    
   \              0xF1 0xA2    
   \              0x93 0xBD    
   \              0x8C 0xDF    
   \              0xEE 0x79    
   \   000000DD   0x48 0x1B          DC8 72, 27, 42, 193, 240, 163, 146, 5, 52, 103, 86, 120, 73, 26, 43
   \              0x2A 0xC1    
   \              0xF0 0xA3    
   \              0x92 0x05    
   \              0x34 0x67    
   \              0x56 0x78    
   \              0x49 0x1A    
   \              0x2B         
   \   000000EC   0xBC 0x8D          DC8 188, 141, 222, 239, 130, 179, 224, 209, 70, 119, 36, 21, 59, 10, 89
   \              0xDE 0xEF    
   \              0x82 0xB3    
   \              0xE0 0xD1    
   \              0x46 0x77    
   \              0x24 0x15    
   \              0x3B 0x0A    
   \              0x59         
   \   000000FB   0x68 0xFF          DC8 104, 255, 206, 157, 172
   \              0xCE 0x9D    
   \              0xAC         
     63              0x00, 0x31, 0x62, 0x53, 0xC4, 0xF5, 0xA6, 0x97,
     64              0xB9, 0x88, 0xDB, 0xEA, 0x7D, 0x4C, 0x1F, 0x2E,
     65              0x43, 0x72, 0x21, 0x10, 0x87, 0xB6, 0xE5, 0xD4,
     66              0xFA, 0xCB, 0x98, 0xA9, 0x3E, 0x0F, 0x5C, 0x6D,
     67              0x86, 0xB7, 0xE4, 0xD5, 0x42, 0x73, 0x20, 0x11,
     68              0x3F, 0x0E, 0x5D, 0x6C, 0xFB, 0xCA, 0x99, 0xA8,
     69              0xC5, 0xF4, 0xA7, 0x96, 0x01, 0x30, 0x63, 0x52,
     70              0x7C, 0x4D, 0x1E, 0x2F, 0xB8, 0x89, 0xDA, 0xEB,
     71              0x3D, 0x0C, 0x5F, 0x6E, 0xF9, 0xC8, 0x9B, 0xAA,
     72              0x84, 0xB5, 0xE6, 0xD7, 0x40, 0x71, 0x22, 0x13,
     73              0x7E, 0x4F, 0x1C, 0x2D, 0xBA, 0x8B, 0xD8, 0xE9,
     74              0xC7, 0xF6, 0xA5, 0x94, 0x03, 0x32, 0x61, 0x50,
     75              0xBB, 0x8A, 0xD9, 0xE8, 0x7F, 0x4E, 0x1D, 0x2C,
     76              0x02, 0x33, 0x60, 0x51, 0xC6, 0xF7, 0xA4, 0x95,
     77              0xF8, 0xC9, 0x9A, 0xAB, 0x3C, 0x0D, 0x5E, 0x6F,
     78              0x41, 0x70, 0x23, 0x12, 0x85, 0xB4, 0xE7, 0xD6,
     79              0x7A, 0x4B, 0x18, 0x29, 0xBE, 0x8F, 0xDC, 0xED,
     80              0xC3, 0xF2, 0xA1, 0x90, 0x07, 0x36, 0x65, 0x54,
     81              0x39, 0x08, 0x5B, 0x6A, 0xFD, 0xCC, 0x9F, 0xAE,
     82              0x80, 0xB1, 0xE2, 0xD3, 0x44, 0x75, 0x26, 0x17,
     83              0xFC, 0xCD, 0x9E, 0xAF, 0x38, 0x09, 0x5A, 0x6B,
     84              0x45, 0x74, 0x27, 0x16, 0x81, 0xB0, 0xE3, 0xD2,
     85              0xBF, 0x8E, 0xDD, 0xEC, 0x7B, 0x4A, 0x19, 0x28,
     86              0x06, 0x37, 0x64, 0x55, 0xC2, 0xF3, 0xA0, 0x91,
     87              0x47, 0x76, 0x25, 0x14, 0x83, 0xB2, 0xE1, 0xD0,
     88              0xFE, 0xCF, 0x9C, 0xAD, 0x3A, 0x0B, 0x58, 0x69,
     89              0x04, 0x35, 0x66, 0x57, 0xC0, 0xF1, 0xA2, 0x93,
     90              0xBD, 0x8C, 0xDF, 0xEE, 0x79, 0x48, 0x1B, 0x2A,
     91              0xC1, 0xF0, 0xA3, 0x92, 0x05, 0x34, 0x67, 0x56,
     92              0x78, 0x49, 0x1A, 0x2B, 0xBC, 0x8D, 0xDE, 0xEF,
     93              0x82, 0xB3, 0xE0, 0xD1, 0x46, 0x77, 0x24, 0x15,
     94              0x3B, 0x0A, 0x59, 0x68, 0xFF, 0xCE, 0x9D, 0xAC
     95          };
     96          //------------------------------------------------------------------------------------
     97          

   \                                 In section .text, align 2, keep-with-next
     98          void TNandWrite::NW_Init()
     99          {
   \                     _ZN10TNandWrite7NW_InitEv: (+1)
   \   00000000   0xB500             PUSH     {LR}
   \   00000002   0xB085             SUB      SP,SP,#+20
    100            xTaskCreate(TASK_DataWriteProcessor,
    101                        (signed char *) "DataWrite",
    102                        configMINIMAL_STACK_SIZE,
    103                        NULL, 
    104                        tskIDLE_PRIORITY+1,
    105                        &xhDataWrite);
   \   00000004   0x2000             MOVS     R0,#+0
   \   00000006   0x9003             STR      R0,[SP, #+12]
   \   00000008   0x9002             STR      R0,[SP, #+8]
   \   0000000A   0x....             LDR.N    R0,??DataTable11
   \   0000000C   0x9001             STR      R0,[SP, #+4]
   \   0000000E   0x2001             MOVS     R0,#+1
   \   00000010   0x9000             STR      R0,[SP, #+0]
   \   00000012   0x2300             MOVS     R3,#+0
   \   00000014   0x2280             MOVS     R2,#+128
   \   00000016   0x.... 0x....      ADR.W    R1,?_0
   \   0000001A   0x.... 0x....      ADR.W    R0,_ZN10TNandWrite23TASK_DataWriteProcessorEPv
   \   0000001E   0x.... 0x....      BL       xTaskGenericCreate
    106          }
   \   00000022   0xB005             ADD      SP,SP,#+20
   \   00000024   0xBD00             POP      {PC}             ;; return
    107          //------------------------------------------------------------------------------------
    108          

   \                                 In section .text, align 2, keep-with-next
    109          uint32_t TNandWrite::NW_AddDataWFrame(const uint8_t *data, uint32_t size)
    110          {
   \                     _ZN10TNandWrite16NW_AddDataWFrameEPKhj: (+1)
   \   00000000   0xB5F8             PUSH     {R3-R7,LR}
   \   00000002   0x4604             MOV      R4,R0
   \   00000004   0x460D             MOV      R5,R1
    111            static volatile bool Sync = true;
    112            
    113            if(!Sync) return adwfWait;
   \   00000006   0x....             LDR.N    R6,??DataTable11_1
   \   00000008   0x78F0             LDRB     R0,[R6, #+3]
   \   0000000A   0x2800             CMP      R0,#+0
   \   0000000C   0xD002             BEQ.N    ??NW_AddDataWFrame_0
    114            if(WaitWrProcess) return adwfWait;
   \   0000000E   0x7870             LDRB     R0,[R6, #+1]
   \   00000010   0x2800             CMP      R0,#+0
   \   00000012   0xD001             BEQ.N    ??NW_AddDataWFrame_1
   \                     ??NW_AddDataWFrame_0: (+1)
   \   00000014   0x2001             MOVS     R0,#+1
   \   00000016   0xBDF2             POP      {R1,R4-R7,PC}
    115            Sync = false;  
   \                     ??NW_AddDataWFrame_1: (+1)
   \   00000018   0x2000             MOVS     R0,#+0
   \   0000001A   0x70F0             STRB     R0,[R6, #+3]
    116            
    117            for(int i = 0;i < size;i++)
   \   0000001C   0x4607             MOV      R7,R0
   \   0000001E   0xE008             B.N      ??NW_AddDataWFrame_2
    118            {
    119              Data256Buffer[DataBufferIndx++] = data[i];
    120              if(DataBufferIndx >= (NW_DATABUFF_SZ)) DataBufferIndx = 0;
    121              if((DataBufferIndx%NW_DATABUFF_SZ_HALF) == 0)
    122              {
    123                if(DataBufferIndx == NW_DATABUFF_SZ_HALF) AddDataBuffHalfTransferFlag = true;
    124                else AddDataBuffHalfTransferFlag = false;
   \                     ??NW_AddDataWFrame_3: (+1)
   \   00000020   0x2000             MOVS     R0,#+0
   \   00000022   0x7030             STRB     R0,[R6, #+0]
    125                  
    126                WaitWrProcess = true;
   \                     ??NW_AddDataWFrame_4: (+1)
   \   00000024   0x2001             MOVS     R0,#+1
   \   00000026   0x7070             STRB     R0,[R6, #+1]
    127                NandWrProcc = true;
   \   00000028   0x70B0             STRB     R0,[R6, #+2]
    128                vTaskResume(xhDataWrite);
   \   0000002A   0x6870             LDR      R0,[R6, #+4]
   \   0000002C   0x.... 0x....      BL       vTaskResume
   \                     ??NW_AddDataWFrame_5: (+1)
   \   00000030   0x1C7F             ADDS     R7,R7,#+1
   \                     ??NW_AddDataWFrame_2: (+1)
   \   00000032   0x42AF             CMP      R7,R5
   \   00000034   0xD218             BCS.N    ??NW_AddDataWFrame_6
   \   00000036   0x68B0             LDR      R0,[R6, #+8]
   \   00000038   0x5D39             LDRB     R1,[R7, R4]
   \   0000003A   0x....             LDR.N    R2,??DataTable11_2
   \   0000003C   0x5481             STRB     R1,[R0, R2]
   \   0000003E   0x1C40             ADDS     R0,R0,#+1
   \   00000040   0x60B0             STR      R0,[R6, #+8]
   \   00000042   0xF5B0 0x4F80      CMP      R0,#+16384
   \   00000046   0xDB01             BLT.N    ??NW_AddDataWFrame_7
   \   00000048   0x2000             MOVS     R0,#+0
   \   0000004A   0x60B0             STR      R0,[R6, #+8]
   \                     ??NW_AddDataWFrame_7: (+1)
   \   0000004C   0x68B0             LDR      R0,[R6, #+8]
   \   0000004E   0x1301             ASRS     R1,R0,#+12
   \   00000050   0xEB00 0x41D1      ADD      R1,R0,R1, LSR #+19
   \   00000054   0x1349             ASRS     R1,R1,#+13
   \   00000056   0xEBB0 0x3141      SUBS     R1,R0,R1, LSL #+13
   \   0000005A   0xD1E9             BNE.N    ??NW_AddDataWFrame_5
   \   0000005C   0xF5B0 0x5F00      CMP      R0,#+8192
   \   00000060   0xD1DE             BNE.N    ??NW_AddDataWFrame_3
   \   00000062   0x2001             MOVS     R0,#+1
   \   00000064   0x7030             STRB     R0,[R6, #+0]
   \   00000066   0xE7DD             B.N      ??NW_AddDataWFrame_4
    129              }
    130            }
    131            
    132            Sync = true;
   \                     ??NW_AddDataWFrame_6: (+1)
   \   00000068   0x2001             MOVS     R0,#+1
   \   0000006A   0x70F0             STRB     R0,[R6, #+3]
    133            
    134            return adwfNoError;
   \   0000006C   0x2000             MOVS     R0,#+0
   \   0000006E   0xBDF2             POP      {R1,R4-R7,PC}    ;; return
    135          }

   \                                 In section .data, align 4
   \                     _ZN10TNandWrite27AddDataBuffHalfTransferFlagE:
   \   00000000   0x00               DC8 0
   \                     WaitWrProcess:
   \   00000001   0x00               DC8 0
   \                     _ZN10TNandWrite11NandWrProccE:
   \   00000002   0x00               DC8 0
   \   00000003   0x01               DC8 1
   \                     _ZN10TNandWrite11xhDataWriteE:
   \   00000004   0x00 0x00          DC8 0, 0, 0, 0
   \              0x00 0x00    
   \                     _ZN10TNandWrite14DataBufferIndxE:
   \   00000008   0x00000000         DC32 0
   \                     _ZN10TNandWrite11ICI_IRQ_CntE:
   \   0000000C   0xFFFFFFCE         DC32 -50
    136          //------------------------------------------------------------------------------------
    137          

   \                                 In section .text, align 2, keep-with-next
    138          bool TNandWrite::NW_WriteOutWFrame() //write data is not completed before the end of the page
    139          {
   \                     _ZN10TNandWrite17NW_WriteOutWFrameEv: (+1)
   \   00000000   0xB580             PUSH     {R7,LR}
    140          //  if(MakeECC) return false; // если данные поступают быстрее чем происходит обработка блока 256 то ошибка
    141            
    142            if(DataBufferIndx >= NW_DATABUFF_SZ_HALF)
   \   00000002   0x....             LDR.N    R0,??DataTable11_1
   \   00000004   0x6881             LDR      R1,[R0, #+8]
   \   00000006   0xF5B1 0x5F00      CMP      R1,#+8192
   \   0000000A   0x....             LDR.N    R3,??DataTable11_2
   \   0000000C   0xDB0C             BLT.N    ??NW_WriteOutWFrame_0
    143            {
    144              for(int i = DataBufferIndx;i < NW_DATABUFF_SZ;i++)
   \   0000000E   0x22FF             MOVS     R2,#+255
   \   00000010   0xE001             B.N      ??NW_WriteOutWFrame_1
    145              {
    146                Data256Buffer[i] = 0xFF;
   \                     ??NW_WriteOutWFrame_2: (+1)
   \   00000012   0x54CA             STRB     R2,[R1, R3]
    147              }
   \   00000014   0x1C49             ADDS     R1,R1,#+1
   \                     ??NW_WriteOutWFrame_1: (+1)
   \   00000016   0xF5B1 0x4F80      CMP      R1,#+16384
   \   0000001A   0xDBFA             BLT.N    ??NW_WriteOutWFrame_2
    148              DataBufferIndx = 0;
   \   0000001C   0x2100             MOVS     R1,#+0
   \   0000001E   0x6081             STR      R1,[R0, #+8]
   \   00000020   0xE008             B.N      ??NW_WriteOutWFrame_3
    149            }
    150            else
    151            {
    152              for(int i = DataBufferIndx;i < NW_DATABUFF_SZ_HALF;i++)
    153              {
    154                Data256Buffer[i] = 0xFF;
   \                     ??NW_WriteOutWFrame_4: (+1)
   \   00000022   0x22FF             MOVS     R2,#+255
   \   00000024   0x54CA             STRB     R2,[R1, R3]
    155              }
   \   00000026   0x1C49             ADDS     R1,R1,#+1
   \                     ??NW_WriteOutWFrame_0: (+1)
   \   00000028   0xF5B1 0x5F00      CMP      R1,#+8192
   \   0000002C   0xDBF9             BLT.N    ??NW_WriteOutWFrame_4
    156              DataBufferIndx = NW_DATABUFF_SZ_HALF;
   \   0000002E   0xF44F 0x5100      MOV      R1,#+8192
   \   00000032   0x6081             STR      R1,[R0, #+8]
    157            }  
    158              
    159            AddDataBuffHalfTransferFlag = !AddDataBuffHalfTransferFlag;  
   \                     ??NW_WriteOutWFrame_3: (+1)
   \   00000034   0x7801             LDRB     R1,[R0, #+0]
   \   00000036   0xF081 0x0101      EOR      R1,R1,#0x1
   \   0000003A   0x7001             STRB     R1,[R0, #+0]
    160          //  MakeECC = true;
    161          //  ForcedWritePage = true;
    162            NandWrProcc = true;
   \   0000003C   0x2101             MOVS     R1,#+1
   \   0000003E   0x7081             STRB     R1,[R0, #+2]
    163            vTaskResume(xhDataWrite);
   \   00000040   0x6840             LDR      R0,[R0, #+4]
   \   00000042   0x.... 0x....      BL       vTaskResume
    164            
    165            return true;
   \   00000046   0x2001             MOVS     R0,#+1
   \   00000048   0xBD02             POP      {R1,PC}          ;; return
    166          }
    167          //------------------------------------------------------------------------------------
    168          

   \                                 In section .text, align 2, keep-with-next
    169          bool TNandWrite::NW_WriteBlockToFile(uint8_t *data,int size)
    170          {
   \                     _ZN10TNandWrite19NW_WriteBlockToFileEPhi: (+1)
   \   00000000   0xB570             PUSH     {R4-R6,LR}
   \   00000002   0xB082             SUB      SP,SP,#+8
   \   00000004   0x4606             MOV      R6,R0
   \   00000006   0x460C             MOV      R4,R1
    171            static bool Once = true;
    172            unsigned int BwW;
    173            
    174            FRESULT err;
    175          
    176            err = f_open( &f1, "KR01.RAW", FA_OPEN_EXISTING | FA_WRITE );
   \   00000008   0x....             LDR.N    R5,??DataTable11_3
   \   0000000A   0x2202             MOVS     R2,#+2
   \   0000000C   0x.... 0x....      ADR.W    R1,?_1
   \   00000010   0x1D28             ADDS     R0,R5,#+4
   \   00000012   0x.... 0x....      BL       f_open
    177          //    err = f_lseek(&f1 ,f1.fsize);
    178              
    179            if(Once)
   \   00000016   0x7868             LDRB     R0,[R5, #+1]
   \   00000018   0x2800             CMP      R0,#+0
   \   0000001A   0xD002             BEQ.N    ??NW_WriteBlockToFile_0
    180            {  
    181              Once = false;
   \   0000001C   0x2000             MOVS     R0,#+0
   \   0000001E   0x7068             STRB     R0,[R5, #+1]
   \   00000020   0xE009             B.N      ??NW_WriteBlockToFile_1
    182            }  
    183            else
    184            {
    185              for(int j = 0;j < sizeof(FIL);j++)
   \                     ??NW_WriteBlockToFile_0: (+1)
   \   00000022   0x2000             MOVS     R0,#+0
   \   00000024   0xE005             B.N      ??NW_WriteBlockToFile_2
    186              {
    187                uint8_t *f1_ptr = (uint8_t *)&f1;
    188                uint8_t *f2_ptr = (uint8_t *)&f2;
    189                f1_ptr[j] = f2_ptr[j];
   \                     ??NW_WriteBlockToFile_3: (+1)
   \   00000026   0x1941             ADDS     R1,R0,R5
   \   00000028   0xF891 0x102C      LDRB     R1,[R1, #+44]
   \   0000002C   0x1942             ADDS     R2,R0,R5
   \   0000002E   0x7111             STRB     R1,[R2, #+4]
    190              }
   \   00000030   0x1C40             ADDS     R0,R0,#+1
   \                     ??NW_WriteBlockToFile_2: (+1)
   \   00000032   0x2828             CMP      R0,#+40
   \   00000034   0xD3F7             BCC.N    ??NW_WriteBlockToFile_3
    191            }
    192            err = f_write( &f1, data, size, &BwW );
    193            if(err == FR_OK) 
   \                     ??NW_WriteBlockToFile_1: (+1)
   \   00000036   0xAB00             ADD      R3,SP,#+0
   \   00000038   0x4622             MOV      R2,R4
   \   0000003A   0x4631             MOV      R1,R6
   \   0000003C   0x1D28             ADDS     R0,R5,#+4
   \   0000003E   0x.... 0x....      BL       f_write
   \   00000042   0x2800             CMP      R0,#+0
   \   00000044   0xD113             BNE.N    ??NW_WriteBlockToFile_4
    194            {
    195              for(int j = 0;j < sizeof(FIL);j++)
   \   00000046   0x2000             MOVS     R0,#+0
   \   00000048   0xE005             B.N      ??NW_WriteBlockToFile_5
    196              {
    197                uint8_t *f1_ptr = (uint8_t *)&f1;
    198                uint8_t *f2_ptr = (uint8_t *)&f2;
    199                f2_ptr[j] = f1_ptr[j];
   \                     ??NW_WriteBlockToFile_6: (+1)
   \   0000004A   0x1941             ADDS     R1,R0,R5
   \   0000004C   0x7909             LDRB     R1,[R1, #+4]
   \   0000004E   0x1942             ADDS     R2,R0,R5
   \   00000050   0xF882 0x102C      STRB     R1,[R2, #+44]
    200              }
   \   00000054   0x1C40             ADDS     R0,R0,#+1
   \                     ??NW_WriteBlockToFile_5: (+1)
   \   00000056   0x2828             CMP      R0,#+40
   \   00000058   0xD3F7             BCC.N    ??NW_WriteBlockToFile_6
    201              
    202              FlashCardRemoved = false;
   \   0000005A   0x2000             MOVS     R0,#+0
   \   0000005C   0x7028             STRB     R0,[R5, #+0]
    203            }
    204            else 
    205            {
    206              //если запись остановлена - перегружаем f0 и f4
    207             
    208              TDevice::SystemReset();
    209          
    210          //    FlashCardRemoved = true;
    211          //    TSDProcessor::SDPresent = false;
    212          //    TGuiObjects::ToolbarSet(TBFM_MEMCARD,0);
    213          //    TAppProcessor::StartRecording = false;
    214          //    TSDProcessor::SDStartWrPool = false;
    215          //    TGuiObjects::GUIDesktopShowTime();
    216          //    DataBlockLenghtNBlockCRC = 0; 
    217          //    DataBlockNum = 0;
    218          //    DataBufferIndx = 0;
    219          //    NW_PageIndx = 0;
    220          //    MakeECC = true;
    221          //    ForcedWritePage = false;
    222          //    AddDataBuffHalfTransferFlag = false;
    223          //    txBufferIndx = 0;
    224          //    WaitWrProcess = false;
    225          
    226              return false;
    227            }
    228            f_close( &f1 );
   \   0000005E   0x1D28             ADDS     R0,R5,#+4
   \   00000060   0x.... 0x....      BL       f_close
    229            if(size != BwW) 
   \   00000064   0x9800             LDR      R0,[SP, #+0]
   \   00000066   0x4284             CMP      R4,R0
   \   00000068   0xD005             BEQ.N    ??NW_WriteBlockToFile_7
    230              return false;
   \   0000006A   0x2000             MOVS     R0,#+0
   \   0000006C   0xBD76             POP      {R1,R2,R4-R6,PC}
   \                     ??NW_WriteBlockToFile_4: (+1)
   \   0000006E   0x.... 0x....      BL       _ZN7TDevice11SystemResetEv
   \   00000072   0x2000             MOVS     R0,#+0
   \   00000074   0xBD76             POP      {R1,R2,R4-R6,PC}
    231            else
    232              return true;
   \                     ??NW_WriteBlockToFile_7: (+1)
   \   00000076   0x2001             MOVS     R0,#+1
   \   00000078   0xBD76             POP      {R1,R2,R4-R6,PC}  ;; return
    233          }

   \                                 In section .data, align 4
   \                     _ZN10TNandWrite16FlashCardRemovedE:
   \   00000000   0x00               DC8 0
   \   00000001   0x01               DC8 1
   \   00000002   0x00 0x00          DC8 0, 0
   \                     f1:
   \   00000004   0x00 0x00          DC8 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
   \              0x00 0x00    
   \              0x00 0x00    
   \              0x00 0x00    
   \              0x00 0x00    
   \              0x00 0x00    
   \              0x00 0x00    
   \              0x00 0x00    
   \   00000014   0x00 0x00          DC8 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
   \              0x00 0x00    
   \              0x00 0x00    
   \              0x00 0x00    
   \              0x00 0x00    
   \              0x00 0x00    
   \              0x00 0x00    
   \              0x00 0x00    
   \   00000024   0x00 0x00          DC8 0, 0, 0, 0, 0, 0, 0, 0
   \              0x00 0x00    
   \              0x00 0x00    
   \              0x00 0x00    
   \                     f2:
   \   0000002C   0x00 0x00          DC8 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
   \              0x00 0x00    
   \              0x00 0x00    
   \              0x00 0x00    
   \              0x00 0x00    
   \              0x00 0x00    
   \              0x00 0x00    
   \              0x00 0x00    
   \   0000003C   0x00 0x00          DC8 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
   \              0x00 0x00    
   \              0x00 0x00    
   \              0x00 0x00    
   \              0x00 0x00    
   \              0x00 0x00    
   \              0x00 0x00    
   \              0x00 0x00    
   \   0000004C   0x00 0x00          DC8 0, 0, 0, 0, 0, 0, 0, 0
   \              0x00 0x00    
   \              0x00 0x00    
   \              0x00 0x00    

   \                                 In section .data, align 1
   \                     _ZN10TNandWrite7MakeECCE:
   \   00000000   0x01               DC8 1

   \                                 In section .data, align 4
   \                     _ZN10TNandWrite7WF_TypeE:
   \   00000000   0x00 0x00          DC8 0, 0, 0, 0
   \              0x00 0x00    
   \                     _ZN10TNandWrite15BeginDataWFrameE:
   \   00000004   0x00               DC8 0
   \                     _ZN10TNandWrite19GlobalEnableWritingE:
   \   00000005   0x01               DC8 1
   \   00000006   0x00 0x00          DC8 0, 0
   \                     _ZN10TNandWrite24DataBlockLenghtNBlockCRCE:
   \   00000008   0x00000000         DC32 0
   \                     _ZN10TNandWrite12DataBlockNumE:
   \   0000000C   0x00000000         DC32 0
   \                     _ZN10TNandWrite15DataBlockSampleE:
   \   00000010   0x00 0x00          DC8 0, 0, 0, 0
   \              0x00 0x00    
    234          //------------------------------------------------------------------------------------
    235          

   \                                 In section .text, align 4, keep-with-next
    236          void TNandWrite::TASK_DataWriteProcessor(void *pvParameters)
    237          {
   \                     _ZN10TNandWrite23TASK_DataWriteProcessorEPv: (+1)
   \   00000000   0xB510             PUSH     {R4,LR}
    238            vTaskSuspend(NULL);
   \   00000002   0x2000             MOVS     R0,#+0
   \   00000004   0x.... 0x....      BL       vTaskSuspend
   \   00000008   0x....             LDR.N    R4,??DataTable11_1
   \   0000000A   0xE00D             B.N      ??TASK_DataWriteProcessor_0
    239            
    240            uint8_t *buffPtr;
    241            
    242            while(1)
    243            {
    244          //  if(MakeECC)
    245              
    246              {
    247                if(AddDataBuffHalfTransferFlag)
    248                {
    249                  buffPtr = &Data256Buffer[0];
    250                }  
    251                else
    252                {
    253                  buffPtr = &Data256Buffer[NW_DATABUFF_SZ_HALF];
   \                     ??TASK_DataWriteProcessor_1: (+1)
   \   0000000C   0xF500 0x5000      ADD      R0,R0,#+8192
    254                }  
    255                
    256                #ifdef NW_LED
    257          //!!!    TDevice::LedOn();
    258                #endif
    259                
    260                NW_WriteBlockToFile(buffPtr,NW_DATABUFF_SZ_HALF);
   \                     ??TASK_DataWriteProcessor_2: (+1)
   \   00000010   0xF44F 0x5100      MOV      R1,#+8192
   \   00000014   0x.... 0x....      BL       _ZN10TNandWrite19NW_WriteBlockToFileEPhi
    261                
    262                #ifdef NW_LED
    263                   TDevice::LedOff();
    264                #endif
    265                
    266                WaitWrProcess = false;
   \   00000018   0x2000             MOVS     R0,#+0
   \   0000001A   0x7060             STRB     R0,[R4, #+1]
    267              }
    268              
    269              //таск работает - сбрас. счетчик ICI_IRQ_Cnt 
    270              ICI_IRQ_Cnt = 0;
   \   0000001C   0x60E0             STR      R0,[R4, #+12]
    271              
    272              NandWrProcc = false;
   \   0000001E   0x70A0             STRB     R0,[R4, #+2]
    273          //  GPIO_ResetBits( GPIOA, GPIO_Pin_8 );
    274              StopModePeriod = false;
   \   00000020   0x....             LDR.N    R1,??DataTable11_4
   \   00000022   0x7008             STRB     R0,[R1, #+0]
    275              vTaskSuspend(NULL);
   \   00000024   0x.... 0x....      BL       vTaskSuspend
   \                     ??TASK_DataWriteProcessor_0: (+1)
   \   00000028   0x....             LDR.N    R0,??DataTable11_2
   \   0000002A   0x7821             LDRB     R1,[R4, #+0]
   \   0000002C   0x2900             CMP      R1,#+0
   \   0000002E   0xD0ED             BEQ.N    ??TASK_DataWriteProcessor_1
   \   00000030   0xE7EE             B.N      ??TASK_DataWriteProcessor_2
    276          //  GPIO_SetBits( GPIOA, GPIO_Pin_8 );
    277            }
    278          }
    279          //------------------------------------------------------------------------------------
    280          

   \                                 In section .text, align 2, keep-with-next
    281          void TNandWrite::NW_WriteEpilog()
    282          {
    283          }
   \                     _ZN10TNandWrite14NW_WriteEpilogEv: (+1)
   \   00000000   0x4770             BX       LR               ;; return
    284          //------------------------------------------------------------------------------------
    285          

   \                                 In section .text, align 2, keep-with-next
    286          void TNandWrite::NW_WriteEpilogRestore()
    287          {
    288          }
   \                     _ZN10TNandWrite21NW_WriteEpilogRestoreEv: (+1)
   \   00000000   0x4770             BX       LR               ;; return
    289          //------------------------------------------------------------------------------------
    290          

   \                                 In section .text, align 2, keep-with-next
    291          void TNandWrite::NW_WriteProlog() // write wfStor to EEPROM 
    292          {
    293          //  GlobalEnableWriting = false;
    294          }
   \                     _ZN10TNandWrite14NW_WritePrologEv: (+1)
   \   00000000   0x4770             BX       LR               ;; return
    295          //------------------------------------------------------------------------------------
    296          

   \                                 In section .text, align 2, keep-with-next
    297          bool TNandWrite::NW_BeginDataWFrame(wfType WFType,uint32_t spl)
    298          {
    299            if(!GlobalEnableWriting) return true; //no waiting, just ignore 
   \                     _ZN10TNandWrite18NW_BeginDataWFrameE6wfTypej: (+1)
   \   00000000   0x....             LDR.N    R2,??DataTable11_5
   \   00000002   0x7953             LDRB     R3,[R2, #+5]
   \   00000004   0x2B00             CMP      R3,#+0
   \   00000006   0xD101             BNE.N    ??NW_BeginDataWFrame_0
   \   00000008   0x2001             MOVS     R0,#+1
   \   0000000A   0x4770             BX       LR
    300            if(BeginDataWFrame) return false;
   \                     ??NW_BeginDataWFrame_0: (+1)
   \   0000000C   0x7913             LDRB     R3,[R2, #+4]
   \   0000000E   0x2B00             CMP      R3,#+0
   \   00000010   0xD001             BEQ.N    ??NW_BeginDataWFrame_1
   \   00000012   0x2000             MOVS     R0,#+0
   \   00000014   0x4770             BX       LR
    301            BeginDataWFrame = true;
   \                     ??NW_BeginDataWFrame_1: (+1)
   \   00000016   0x2301             MOVS     R3,#+1
   \   00000018   0x7113             STRB     R3,[R2, #+4]
    302            
    303            WF_Type = WFType;
   \   0000001A   0x6010             STR      R0,[R2, #+0]
    304            DataBlockLenghtNBlockCRC = 0xFF000000;
   \   0000001C   0xF04F 0x407F      MOV      R0,#-16777216
   \   00000020   0x6090             STR      R0,[R2, #+8]
    305            
    306            DataBlockSample = spl;
   \   00000022   0x6111             STR      R1,[R2, #+16]
    307            
    308            return true;
   \   00000024   0x4618             MOV      R0,R3
   \   00000026   0x4770             BX       LR               ;; return
    309          }
    310          //------------------------------------------------------------------------------------
    311          

   \                                 In section .text, align 2, keep-with-next
    312          uint8_t TNandWrite::NW_BlockCRC(const uint8_t *data, uint32_t size, uint8_t prevCRC)
    313          {
   \                     _ZN10TNandWrite11NW_BlockCRCEPKhjh: (+1)
   \   00000000   0xB410             PUSH     {R4}
    314            unsigned char crc = prevCRC;
   \   00000002   0xE005             B.N      ??NW_BlockCRC_0
    315           
    316            while(size--) crc = Crc8Table[crc ^ *data++];
   \                     ??NW_BlockCRC_1: (+1)
   \   00000004   0x.... 0x....      ADR.W    R3,Crc8Table
   \   00000008   0xF810 0x4B01      LDRB     R4,[R0], #+1
   \   0000000C   0x4062             EORS     R2,R4,R2
   \   0000000E   0x5CD2             LDRB     R2,[R2, R3]
   \                     ??NW_BlockCRC_0: (+1)
   \   00000010   0x460B             MOV      R3,R1
   \   00000012   0x1E59             SUBS     R1,R3,#+1
   \   00000014   0x2B00             CMP      R3,#+0
   \   00000016   0xD1F5             BNE.N    ??NW_BlockCRC_1
    317           
    318            return crc;  
   \   00000018   0x4610             MOV      R0,R2
   \   0000001A   0xBC10             POP      {R4}
   \   0000001C   0x4770             BX       LR               ;; return
    319          }
    320          //------------------------------------------------------------------------------------
    321          

   \                                 In section .text, align 2, keep-with-next
    322          bool TNandWrite::NW_UpdateDataSectorOfWFrame(const uint8_t *data, uint32_t size)
    323          {
   \                     _ZN10TNandWrite27NW_UpdateDataSectorOfWFrameEPKhj: (+1)
   \   00000000   0xB570             PUSH     {R4-R6,LR}
   \   00000002   0x4604             MOV      R4,R0
   \   00000004   0x460D             MOV      R5,R1
    324            if(!GlobalEnableWriting) return true; //no waiting, just ignore 
   \   00000006   0x....             LDR.N    R6,??DataTable11_5
   \   00000008   0x7970             LDRB     R0,[R6, #+5]
   \   0000000A   0x2800             CMP      R0,#+0
   \   0000000C   0xD101             BNE.N    ??NW_UpdateDataSectorOfWFrame_0
   \   0000000E   0x2001             MOVS     R0,#+1
   \   00000010   0xBD70             POP      {R4-R6,PC}
    325            uint32_t err = NW_AddDataWFrame(data,size);
    326            if(err != adwfNoError) return false;
   \                     ??NW_UpdateDataSectorOfWFrame_0: (+1)
   \   00000012   0x4620             MOV      R0,R4
   \   00000014   0x.... 0x....      BL       _ZN10TNandWrite16NW_AddDataWFrameEPKhj
   \   00000018   0x2800             CMP      R0,#+0
   \   0000001A   0xD001             BEQ.N    ??NW_UpdateDataSectorOfWFrame_1
   \   0000001C   0x2000             MOVS     R0,#+0
   \   0000001E   0xBD70             POP      {R4-R6,PC}
    327            uint32_t dbl = (DataBlockLenghtNBlockCRC & 0x00FFFFFF);
    328            dbl += size;
    329            DataBlockLenghtNBlockCRC = (DataBlockLenghtNBlockCRC & 0xFF000000) | dbl;
   \                     ??NW_UpdateDataSectorOfWFrame_1: (+1)
   \   00000020   0x68B0             LDR      R0,[R6, #+8]
   \   00000022   0xF000 0x417F      AND      R1,R0,#0xFF000000
   \   00000026   0x0200             LSLS     R0,R0,#+8
   \   00000028   0xEB15 0x2010      ADDS     R0,R5,R0, LSR #+8
   \   0000002C   0x4308             ORRS     R0,R0,R1
   \   0000002E   0x60B0             STR      R0,[R6, #+8]
    330            //Calc CRC
    331            uint8_t crc = (uint8_t)((DataBlockLenghtNBlockCRC & 0xFF000000) >> 24);
    332            crc = NW_BlockCRC(data, size, crc);
   \   00000030   0x0E02             LSRS     R2,R0,#+24
   \   00000032   0x4629             MOV      R1,R5
   \   00000034   0x4620             MOV      R0,R4
   \   00000036   0x.... 0x....      BL       _ZN10TNandWrite11NW_BlockCRCEPKhjh
    333            DataBlockLenghtNBlockCRC = (DataBlockLenghtNBlockCRC & 0x00FFFFFF) | ((uint32_t)crc << 24);
   \   0000003A   0x68B1             LDR      R1,[R6, #+8]
   \   0000003C   0xF360 0x611F      BFI      R1,R0,#+24,#+8
   \   00000040   0x60B1             STR      R1,[R6, #+8]
    334            
    335            DataBlockSample += size;
   \   00000042   0x6930             LDR      R0,[R6, #+16]
   \   00000044   0x1828             ADDS     R0,R5,R0
   \   00000046   0x6130             STR      R0,[R6, #+16]
    336            
    337            return true;
   \   00000048   0x2001             MOVS     R0,#+1
   \   0000004A   0xBD70             POP      {R4-R6,PC}       ;; return
    338          }
    339          //------------------------------------------------------------------------------------
    340          

   \                                 In section .text, align 2, keep-with-next
    341          bool TNandWrite::NW_EndDataWFrame(bool WriteOut, uint32_t *splPtr)
    342          {
   \                     _ZN10TNandWrite16NW_EndDataWFrameEbPj: (+1)
   \   00000000   0xB570             PUSH     {R4-R6,LR}
   \   00000002   0xB086             SUB      SP,SP,#+24
   \   00000004   0x4604             MOV      R4,R0
    343            if(!GlobalEnableWriting) return true; //no waiting, just ignore 
   \   00000006   0x....             LDR.N    R5,??DataTable11_5
   \   00000008   0x7968             LDRB     R0,[R5, #+5]
   \   0000000A   0x2800             CMP      R0,#+0
   \   0000000C   0xD101             BNE.N    ??NW_EndDataWFrame_0
   \   0000000E   0x2001             MOVS     R0,#+1
   \   00000010   0xE047             B.N      ??NW_EndDataWFrame_1
    344          
    345            uint8_t hdrBytes[2+4*4];
    346          
    347            uint32_t _type = *((uint32_t*)&WF_Type);
   \                     ??NW_EndDataWFrame_0: (+1)
   \   00000012   0x682A             LDR      R2,[R5, #+0]
    348          
    349            hdrBytes[0] = (uint8_t)(_type & 0x000000FF);
   \   00000014   0x4610             MOV      R0,R2
   \   00000016   0xF88D 0x0000      STRB     R0,[SP, #+0]
    350            hdrBytes[1] = (uint8_t)((_type & 0x0000FF00) >> 8);
   \   0000001A   0xA800             ADD      R0,SP,#+0
   \   0000001C   0x0A13             LSRS     R3,R2,#+8
   \   0000001E   0x7043             STRB     R3,[R0, #+1]
    351            hdrBytes[2] = (uint8_t)((_type & 0x00FF0000) >> 16);
   \   00000020   0x0C13             LSRS     R3,R2,#+16
   \   00000022   0xF88D 0x3002      STRB     R3,[SP, #+2]
    352            hdrBytes[3] = (uint8_t)((_type & 0xFF000000) >> 24);
   \   00000026   0x0E12             LSRS     R2,R2,#+24
   \   00000028   0xF88D 0x2003      STRB     R2,[SP, #+3]
    353          
    354            hdrBytes[4] = (uint8_t)(DataBlockLenghtNBlockCRC & 0x000000FF);
   \   0000002C   0x68AA             LDR      R2,[R5, #+8]
   \   0000002E   0x7102             STRB     R2,[R0, #+4]
    355            hdrBytes[5] = (uint8_t)((DataBlockLenghtNBlockCRC & 0x0000FF00) >> 8);
   \   00000030   0x0A13             LSRS     R3,R2,#+8
   \   00000032   0x7143             STRB     R3,[R0, #+5]
    356            hdrBytes[6] = (uint8_t)((DataBlockLenghtNBlockCRC & 0x00FF0000) >> 16);
   \   00000034   0x0C13             LSRS     R3,R2,#+16
   \   00000036   0xF88D 0x3006      STRB     R3,[SP, #+6]
    357            hdrBytes[7] = (uint8_t)((DataBlockLenghtNBlockCRC & 0xFF000000) >> 24);
   \   0000003A   0x0E13             LSRS     R3,R2,#+24
   \   0000003C   0xF88D 0x3007      STRB     R3,[SP, #+7]
    358          
    359            hdrBytes[8] = (uint8_t)(DataBlockNum & 0x000000FF);
   \   00000040   0x68EB             LDR      R3,[R5, #+12]
   \   00000042   0x7203             STRB     R3,[R0, #+8]
    360            hdrBytes[9] = (uint8_t)((DataBlockNum & 0x0000FF00) >> 8);
   \   00000044   0x0A1E             LSRS     R6,R3,#+8
   \   00000046   0xF88D 0x6009      STRB     R6,[SP, #+9]
    361            hdrBytes[10] = (uint8_t)((DataBlockNum & 0x00FF0000) >> 16);
   \   0000004A   0x0C1E             LSRS     R6,R3,#+16
   \   0000004C   0xF88D 0x600A      STRB     R6,[SP, #+10]
    362            hdrBytes[11] = (uint8_t)((DataBlockNum & 0xFF000000) >> 24);
   \   00000050   0x0E1B             LSRS     R3,R3,#+24
   \   00000052   0xF88D 0x300B      STRB     R3,[SP, #+11]
    363          
    364            uint32_t _dtSpl = DataBlockSample - (DataBlockLenghtNBlockCRC & 0x00FFFFFF);
   \   00000056   0x692B             LDR      R3,[R5, #+16]
   \   00000058   0x0212             LSLS     R2,R2,#+8
   \   0000005A   0xEBB3 0x2212      SUBS     R2,R3,R2, LSR #+8
    365          
    366            hdrBytes[12] = (uint8_t)(_dtSpl & 0x000000FF);
   \   0000005E   0x7302             STRB     R2,[R0, #+12]
    367            hdrBytes[13] = (uint8_t)((_dtSpl & 0x0000FF00) >> 8);
   \   00000060   0x0A16             LSRS     R6,R2,#+8
   \   00000062   0xF88D 0x600D      STRB     R6,[SP, #+13]
    368            hdrBytes[14] = (uint8_t)((_dtSpl & 0x00FF0000) >> 16);
   \   00000066   0x0C16             LSRS     R6,R2,#+16
   \   00000068   0xF88D 0x600E      STRB     R6,[SP, #+14]
    369            hdrBytes[15] = (uint8_t)((_dtSpl & 0xFF000000) >> 24);
   \   0000006C   0x0E12             LSRS     R2,R2,#+24
   \   0000006E   0xF88D 0x200F      STRB     R2,[SP, #+15]
    370          
    371            hdrBytes[4*4] = 0x55;
   \   00000072   0x2255             MOVS     R2,#+85
   \   00000074   0x7402             STRB     R2,[R0, #+16]
    372            hdrBytes[4*4+1] = 0xAA;
   \   00000076   0x20AA             MOVS     R0,#+170
   \   00000078   0xF88D 0x0011      STRB     R0,[SP, #+17]
    373            
    374            *splPtr = DataBlockSample;// - (DataBlockLenghtNBlockCRC & 0x00FFFFFF);
   \   0000007C   0x600B             STR      R3,[R1, #+0]
    375            
    376            uint32_t err = NW_AddDataWFrame(hdrBytes,2+4*4);
    377            if(err != adwfNoError) return false;
   \   0000007E   0x2112             MOVS     R1,#+18
   \   00000080   0xA800             ADD      R0,SP,#+0
   \   00000082   0x.... 0x....      BL       _ZN10TNandWrite16NW_AddDataWFrameEPKhj
   \   00000086   0x2800             CMP      R0,#+0
   \   00000088   0xD001             BEQ.N    ??NW_EndDataWFrame_2
   \   0000008A   0x2000             MOVS     R0,#+0
   \   0000008C   0xE009             B.N      ??NW_EndDataWFrame_1
    378            
    379            DataBlockNum++;
   \                     ??NW_EndDataWFrame_2: (+1)
   \   0000008E   0x68E8             LDR      R0,[R5, #+12]
   \   00000090   0x1C40             ADDS     R0,R0,#+1
   \   00000092   0x60E8             STR      R0,[R5, #+12]
    380            
    381          //  BKP_WriteBackupRegister(BKP_DR3,(uint16_t)(DataBlockNum & 0x0000FFFF));
    382          //  BKP_WriteBackupRegister(BKP_DR4,(uint16_t)((DataBlockNum & 0xFFFF0000)>>16));
    383          
    384            if(WriteOut) NW_WriteOutWFrame();
   \   00000094   0x2C00             CMP      R4,#+0
   \   00000096   0xD001             BEQ.N    ??NW_EndDataWFrame_3
   \   00000098   0x.... 0x....      BL       _ZN10TNandWrite17NW_WriteOutWFrameEv
    385            
    386            BeginDataWFrame = false;  
   \                     ??NW_EndDataWFrame_3: (+1)
   \   0000009C   0x2000             MOVS     R0,#+0
   \   0000009E   0x7128             STRB     R0,[R5, #+4]
    387            return true;
   \   000000A0   0x2001             MOVS     R0,#+1
   \                     ??NW_EndDataWFrame_1: (+1)
   \   000000A2   0xB006             ADD      SP,SP,#+24
   \   000000A4   0xBD70             POP      {R4-R6,PC}       ;; return
    388          }
    389          //------------------------------------------------------------------------------------
    390          

   \                                 In section .text, align 2, keep-with-next
    391          void TNandWrite::UpdateNStoreRecordSize(int sz)
    392          {
    393            RecordSize += sz;//NAND_PAGE_WITH_SPARE;
   \                     _ZN10TNandWrite22UpdateNStoreRecordSizeEi: (+1)
   \   00000000   0x....             LDR.N    R1,??DataTable11_6
   \   00000002   0x680A             LDR      R2,[R1, #+0]
   \   00000004   0x1880             ADDS     R0,R0,R2
   \   00000006   0x6008             STR      R0,[R1, #+0]
    394            // BKP_WriteBackupRegister(BKP_DR8,(uint16_t)(RecordSize & 0x0000FFFF));
    395            // BKP_WriteBackupRegister(BKP_DR9,(uint16_t)((RecordSize & 0xFFFF0000)>>16));
    396            
    397            // #ifdef RESTORE_BKP
    398              // TEepBackUp::EBK_CalcNStoreCRC16();
    399            // #endif    
    400          }
   \   00000008   0x4770             BX       LR               ;; return

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable11:
   \   00000000   0x........         DC32     _ZN10TNandWrite27AddDataBuffHalfTransferFlagE+0x4

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable11_1:
   \   00000000   0x........         DC32     _ZN10TNandWrite27AddDataBuffHalfTransferFlagE

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable11_2:
   \   00000000   0x........         DC32     _ZN10TNandWrite13Data256BufferE

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable11_3:
   \   00000000   0x........         DC32     _ZN10TNandWrite16FlashCardRemovedE

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable11_4:
   \   00000000   0x........         DC32     StopModePeriod

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable11_5:
   \   00000000   0x........         DC32     _ZN10TNandWrite7WF_TypeE

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable11_6:
   \   00000000   0x........         DC32     _ZN10TNandWrite10RecordSizeE

   \                                 In section .text, align 4, keep-with-next
   \                     ?_0:
   \   00000000   0x44 0x61          DC8 "DataWrite"
   \              0x74 0x61    
   \              0x57 0x72    
   \              0x69 0x74    
   \              0x65 0x00    
   \   0000000A   0x00 0x00          DC8 0, 0

   \                                 In section .text, align 4, keep-with-next
   \                     ?_1:
   \   00000000   0x4B 0x52          DC8 "KR01.RAW"
   \              0x30 0x31    
   \              0x2E 0x52    
   \              0x41 0x57    
   \              0x00         
   \   00000009   0x00 0x00          DC8 0, 0, 0
   \              0x00         
    401          //------------------------------------------------------------------------------------

   Maximum stack usage in bytes:

   .cstack Function
   ------- --------
      24   TNandWrite::NW_AddDataWFrame(uint8_t const *, uint32_t)
        24   -> vTaskResume
       0   TNandWrite::NW_BeginDataWFrame(wfType, uint32_t)
       4   TNandWrite::NW_BlockCRC(uint8_t const *, uint32_t, uint8_t)
      40   TNandWrite::NW_EndDataWFrame(bool, uint32_t *)
        40   -> TNandWrite::NW_AddDataWFrame(uint8_t const *, uint32_t)
        40   -> TNandWrite::NW_WriteOutWFrame()
      24   TNandWrite::NW_Init()
        24   -> xTaskGenericCreate
      16   TNandWrite::NW_UpdateDataSectorOfWFrame(uint8_t const *, uint32_t)
        16   -> TNandWrite::NW_AddDataWFrame(uint8_t const *, uint32_t)
        16   -> TNandWrite::NW_BlockCRC(uint8_t const *, uint32_t, uint8_t)
      24   TNandWrite::NW_WriteBlockToFile(uint8_t *, int)
        24   -> TDevice::SystemReset()
        24   -> f_close
        24   -> f_open
        24   -> f_write
       0   TNandWrite::NW_WriteEpilog()
       0   TNandWrite::NW_WriteEpilogRestore()
       8   TNandWrite::NW_WriteOutWFrame()
         8   -> vTaskResume
       0   TNandWrite::NW_WriteProlog()
       8   TNandWrite::TASK_DataWriteProcessor(void *)
         8   -> TNandWrite::NW_WriteBlockToFile(uint8_t *, int)
         8   -> vTaskSuspend
       0   TNandWrite::UpdateNStoreRecordSize(int)


   Section sizes:

   Bytes  Function/Label
   -----  --------------
       4  ??DataTable11
       4  ??DataTable11_1
       4  ??DataTable11_2
       4  ??DataTable11_3
       4  ??DataTable11_4
       4  ??DataTable11_5
       4  ??DataTable11_6
      12  ?_0
      12  ?_1
     256  Crc8Table
      16  TNandWrite::AddDataBuffHalfTransferFlag
          WaitWrProcess
          TNandWrite::NandWrProcc
          Sync
          TNandWrite::xhDataWrite
          TNandWrite::DataBufferIndx
          TNandWrite::ICI_IRQ_Cnt
   16384  TNandWrite::Data256Buffer
      84  TNandWrite::FlashCardRemoved
          Once
          f1
          f2
       1  TNandWrite::ForcedWritePage
       1  TNandWrite::KeepFirstBlockAsNoMemFull
       1  TNandWrite::MakeECC
       1  TNandWrite::MemoryFull
     112  TNandWrite::NW_AddDataWFrame(uint8_t const *, uint32_t)
      40  TNandWrite::NW_BeginDataWFrame(wfType, uint32_t)
      30  TNandWrite::NW_BlockCRC(uint8_t const *, uint32_t, uint8_t)
     166  TNandWrite::NW_EndDataWFrame(bool, uint32_t *)
      38  TNandWrite::NW_Init()
       4  TNandWrite::NW_PageIndx
      76  TNandWrite::NW_UpdateDataSectorOfWFrame(uint8_t const *, uint32_t)
     122  TNandWrite::NW_WriteBlockToFile(uint8_t *, int)
       2  TNandWrite::NW_WriteEpilog()
       2  TNandWrite::NW_WriteEpilogRestore()
      74  TNandWrite::NW_WriteOutWFrame()
       2  TNandWrite::NW_WriteProlog()
       4  TNandWrite::RecordSize
       2  TNandWrite::StartWriteAddrBlock
      50  TNandWrite::TASK_DataWriteProcessor(void *)
       1  TNandWrite::UnexpectedReset
      10  TNandWrite::UpdateNStoreRecordSize(int)
      20  TNandWrite::WF_Type
          TNandWrite::BeginDataWFrame
          TNandWrite::GlobalEnableWriting
          TNandWrite::DataBlockLenghtNBlockCRC
          TNandWrite::DataBlockNum
          TNandWrite::DataBlockSample
       4  TNandWrite::txBufferIndx

 
 16 402 bytes in section .bss
    121 bytes in section .data
  1 032 bytes in section .text
 
  1 032 bytes of CODE memory
 16 523 bytes of DATA memory

Errors: none
Warnings: none
